<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Central Kitchen Orders</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 10px;
        }
        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 10px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid black;
            padding: 10px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        .calendar {
            display: flex;
            flex-wrap: wrap;
            width: 300px;
            margin-bottom: 20px;
        }
        .calendar div {
            width: calc(100% / 7);
            text-align: center;
            padding: 5px;
            margin: 2px;
            border: 1px solid #ccc;
        }
        .calendar .has-orders {
            background-color: red;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Central Kitchen Orders</h1>
        <div id="calendar" class="calendar"></div>
        <table id="ordersTable">
            <thead>
                <tr id="headerRow">
                    <th>Product</th>
                </tr>
            </thead>
            <tbody id="ordersTableBody">
                <!-- Aggregated orders will be displayed here -->
            </tbody>
        </table>
    </div>

    <script>
        const calendarElement = document.getElementById('calendar');

        function fetchOrders(date) {
            fetch(`http://localhost:3000/api/orders?date=${date}`)
                .then(response => response.json())
                .then(data => {
                    const ordersTableBody = document.getElementById('ordersTableBody');
                    const headerRow = document.getElementById('headerRow');
                    ordersTableBody.innerHTML = '';
                    headerRow.innerHTML = '<th>Product</th>';

                    const aggregated = data.aggregated;
                    const storeOrders = data.storeOrders;
                    const storeNames = Object.keys(storeOrders);

                    storeNames.forEach(store => {
                        const th = document.createElement('th');
                        th.textContent = store;
                        headerRow.appendChild(th);
                    });

                    const totalTh = document.createElement('th');
                    totalTh.textContent = 'Total';
                    headerRow.appendChild(totalTh);

                    for (let product in aggregated) {
                        let row = document.createElement('tr');
                        let productCell = document.createElement('td');
                        productCell.textContent = product;
                        row.appendChild(productCell);

                        storeNames.forEach(store => {
                            let storeCell = document.createElement('td');
                            storeCell.textContent = aggregated[product][store] || 0;
                            row.appendChild(storeCell);
                        });

                        let totalCell = document.createElement('td');
                        totalCell.textContent = aggregated[product].total;
                        row.appendChild(totalCell);

                        ordersTableBody.appendChild(row);
                    }
                })
                .catch((error) => {
                    console.error('Error:', error);
                });
        }

        function createCalendar() {
            fetch('http://localhost:3000/api/dates')
                .then(response => response.json())
                .then(dates => {
                    const today = new Date();
                    const startDay = new Date(today.getFullYear(), today.getMonth(), 1);
                    const endDay = new Date(today.getFullYear(), today.getMonth() + 1, 0);

                    for (let day = startDay; day <= endDay; day.setDate(day.getDate() + 1)) {
                        const dayDiv = document.createElement('div');
                        dayDiv.textContent = day.getDate();

                        const dayString = day.toISOString().split('T')[0];
                        if (dates.includes(dayString)) {
                            dayDiv.classList.add('has-orders');
                        }

                        dayDiv.addEventListener('click', () => {
                            fetchOrders(dayString);
                        });

                        calendarElement.appendChild(dayDiv);
                    }
                })
                .catch((error) => {
                    console.error('Error:', error);
                });
        }

        createCalendar();
    </script>
</body>
</html>
